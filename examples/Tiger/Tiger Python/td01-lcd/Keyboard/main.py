import time
import Tiger
from Tiger import LCD1

lcd = LCD1(kbd=True)


def init_keyb():
    A = (b"\x6B\x6C\x81\x80\x23\x08\x90\x91\x6D\x2C\x2E\x2D\x00\x00\x0A\x20"
         b"\x10\x0D\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
         b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
         b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
         b"\x1B\xF1\xF2\xF3\xF4\xF5\xF6\xF7\x5E\x31\x32\x33\x34\x35\x36\x37"
         b"\x1D\x71\x77\x65\x72\x74\x7A\x75\x0F\x61\x73\x64\x66\x67\x68\x6A"
         b"\x00\x3C\x79\x78\x63\x76\x62\x6E\xF8\xF9\xFA\x00\x00\x1A\xFB\xFC"
         b"\x38\x39\x30\x86\x27\x7F\xFD\xFE\x69\x6F\x70\x82\x2B\x08\x0B\x05")
    lcd.keyboardSetKeyTable(A)
    x0 = time.ticks_ms()
    x1 = time.ticks_ms()
    while x1 - x0 < 10:
        #print(x1)
        x1 = time.ticks_ms()
    A = (b"\x4B\x4C\x84\x83\x27\x08\xB0\xB1\x4D\x3B\x3A\x5F\x00\x00\x0A\x20"
         b"\x10\x0D\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
         b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
         b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
         b"\x1B\xF1\xF2\xF3\xF4\xF5\xF6\xF7\xB4\x21\x22\x86\x24\x25\x26\x2F"
         b"\x1D\x51\x57\x45\x52\x54\x5A\x55\x0F\x41\x53\x44\x46\x47\x48\x4A"
         b"\x00\x3E\x59\x58\x43\x56\x42\x4E\xF8\xF9\xFA\x00\x00\x1A\xFB\xFC"
         b"\x28\x29\x3D\x3F\xB3\x7F\xFD\xFE\x49\x4F\x50\x85\x2A\x08\x0B\x05")
    lcd.keyboardSetKeyShiftTable(A)
    x0 = time.ticks_ms()
    x1 = time.ticks_ms()
    while x1 - x0 < 10:
        #print(x1)
        x1 = time.ticks_ms()
    A = (b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00"
         b"\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00"
         b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
         b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
         b"\x04\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
         b"\x00\x00\x00\x00\x00\x00\x00\x00\x02\x00\x00\x00\x00\x00\x00\x00"
         b"\x03\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
         b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00")
    lcd.keyboardSetKeyAttributeCode(A)
    x0 = time.ticks_ms()
    x1 = time.ticks_ms()
    while x1 - x0 < 10:
       # print(x1)
        x1 = time.ticks_ms()
    lcd.keyboardKeyClickOn()
    lcd.keyboardSetRepeat(20,5)
    lcd.keyboardSetDipSwitch([1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1])


init_keyb()
lcd.clear()

A = b''
Mode = 0

while A != b'\xF1':
    N = 0
    while N == 0:
        N = lcd.getKeyboardBufferSize()
    A = lcd.readKeyboard(1)
    if A == b'\xF1':
        if Mode == 0:
            Mode = 1
            lcd.keyboardKeyClickOn()
        else:
            Mode = 0
            lcd.keyboardKeyClickOff()
    else:
        lcd.writeString(A)

lcd.clear()
lcd.writeString("End Program")